<?php
/**
 * @file
 * Code for the La Liste Search feature.
 */

include_once 'laliste_search.features.inc';

/**
 * Implements hook_entity_property_info_alter().
 */
function laliste_search_entity_property_info_alter(&$info) {
  $info['node']['properties']['country_localized'] = array(
    'type' => 'string',
    'label' => t('country (localized)'),
    'description' => t("Provides the localized country name."),
    'sanitized' => TRUE,
    'getter callback' => 'laliste_search_get_localized_country_callback',
  );
}

/**
 * Implement phponwebsites_get_is_nodeviewcount_callback()
 */
function laliste_search_get_localized_country_callback($item) {
  $country_code = laliste_search_get_country_code($item->nid);
  // let's translate the 2 letter ISO code into the full country name
  //include_once DRUPAL_ROOT . '/includes/locale.inc';
  $country_localized_list = get_localized_country();
  $country = $country_localized_list[strtoupper($country_code)];
  return $country;
}

function laliste_search_get_country_code($nid) {
  $result = db_query("SELECT field_address_country as country_code FROM {field_data_field_address} WHERE entity_id=:nid AND language='en'",
    array(':nid' => $nid))->FetchAssoc();
  return $result['country_code'];
}

/*
 * Return array of localized (french) countries
 */
function get_localized_country() {
  static $countries;

  if (isset($countries)) {
    return $countries;
  }
  $t = get_t();

  $countries = array(
  'AD' => $t('Andorre'),
  'AE' => $t('Emirats Arabes Unis'),
  'AF' => $t('Afghanistan'),
  'AG' => $t('Antigua-et-Barbuda'),
  'AI' => $t('Anguilla'),
  'AL' => $t('Albanie'),
  'AM' => $t('Arménie'),
  'AN' => $t('Antilles néerlandaises'),
  'AO' => $t('Angola'),
  'AQ' => $t('Antarctique'),
  'AR' => $t('Argentine'),
  'AS' => $t('Samoa Américaines'),
  'AT' => $t('Autriche'),
  'AU' => $t('Australie'),
  'AW' => $t('Aruba'),
  'AX' => $t('Iles Aland'),
  'AZ' => $t('Azerbaïdjan'),
  'BA' => $t('Bosnie Herzégovine'),
  'BB' => $t('Barbade'),
  'BD' => $t('Bangladesh'),
  'BE' => $t('Belgique'),
  'BF' => $t('Burkina Faso'),
  'BG' => $t('Bulgarie'),
  'BH' => $t('Bahreïn'),
  'BI' => $t('Burundi'),
  'BJ' => $t('Bénin'),
  'BL' => $t('Saint Barthélemy'),
  'BM' => $t('Bermuda'),
  'BN' => $t('Brunei'),
  'BO' => $t('Bolivie'),
  'BQ' => $t('Caraïbes Pays-Bas'),
  'BR' => $t('Brésil'),
  'BS' => $t('Bahamas'),
  'BT' => $t('Bhoutan'),
  'BV' => $t('Île Bouvet'),
  'BW' => $t('Botswana'),
  'BY' => $t('Belarus'),
  'BZ' => $t('Belize'),
  'CA' => $t('Canada'),
  'CC' => $t('Îles Cocos'),
  'CD' => $t('Congo (Kinshasa)'),
  'CF' => $t('République centrafricaine'),
  'CG' => $t('Congo (Brazzaville)'),
  'CH' => $t('Suisse'),
  'CI' => $t('Côte d\'Ivoire'),
  'CK' => $t('les Îles Cook'),
  'CL' => $t('Chili'),
  'CM' => $t('Cameroun'),
  'CN' => $t('Chine'),
  'CO' => $t('Colombie'),
  'CR' => $t('Costa Rica'),
  'CU' => $t('Cuba'),
  'CV' => $t('Cap-Vert'),
  'CW' => $t('Curaçao'),
  'CX' => $t('Île de noël'),
  'CY' => $t('Chypre'),
  'CZ' => $t('République Tchèque'),
  'DE' => $t('Allemagne'),
  'DJ' => $t('Djibouti'),
  'DK' => $t('Danemark'),
  'DM' => $t('Dominique'),
  'DO' => $t('République Dominicaine'),
  'DZ' => $t('Algérie'),
  'EC' => $t('Equateur'),
  'EE' => $t('Estonie'),
  'EG' => $t('Egypte'),
  'EH' => $t('Sahara occidental'),
  'ER' => $t('Érythrée'),
  'ES' => $t('Espagne'),
  'ET' => $t('Ethiopie'),
  'FI' => $t('Finlande'),
  'FJ' => $t('Fidji'),
  'FK' => $t('Îles Falkland'),
  'FM' => $t('Micronésie'),
  'FO' => $t('Îles Féroé'),
  'FR' => $t('France'),
  'GA' => $t('Gabon'),
  'GB' => $t('Royaume-Uni'),
  'GD' => $t('Grenade'),
  'GE' => $t('Géorgie'),
  'GF' => $t('Guyane Française'),
  'GG' => $t('Guernsey'),
  'GH' => $t('Ghana'),
  'GI' => $t('Gibraltar'),
  'GL' => $t('Groenland'),
  'GM' => $t('Gambie'),
  'GN' => $t('Guinée'),
  'GP' => $t('Guadeloupe'),
  'GQ' => $t('Guinée Équatoriale'),
  'GR' => $t('Grèce'),
  'GS' => $t('Géorgie du Sud et îles Sandwich du Sud'),
  'GT' => $t('Guatemala'),
  'GU' => $t('Guam'),
  'GW' => $t('Guinée-Bissau'),
  'GY' => $t('Guyane'),
  'HK' => $t('Hong Kong S.A.R., Chine'),
  'HM' => $t('Îles Heard et Île McDonald'),
  'HN' => $t('Honduras'),
  'HR' => $t('Croatie'),
  'HT' => $t('Haïti'),
  'HU' => $t('Hongrie'),
  'ID' => $t('Indonésie'),
  'IE' => $t('Irlande'),
  'IL' => $t('Israël'),
  'IM' => $t('Île de Man'),
  'IN' => $t('Inde'),
  'IO' => $t('Territoire Britannique de l\'océan Indien'),
  'IQ' => $t('Irak'),
  'IR' => $t('Iran'),
  'IS' => $t('Islande'),
  'IT' => $t('Italie'),
  'JE' => $t('Jersey'),
  'JM' => $t('Jamaïque'),
  'JO' => $t('Jordanie'),
  'JP' => $t('Japon'),
  'KE' => $t('Kenya'),
  'KG' => $t('Kirghizistan'),
  'KH' => $t('Cambodge'),
  'KI' => $t('Kiribati'),
  'KM' => $t('Comores'),
  'KN' => $t('Saint Kitts et Nevis'),
  'KP' => $t('Corée du Nord'),
  'KR' => $t('Corée du Sud'),
  'KW' => $t('Koweit'),
  'KY' => $t('Îles Caïmans'),
  'KZ' => $t('Kazakhstan'),
  'LA' => $t('Laos'),
  'LB' => $t('Liban'),
  'LC' => $t('Sainte-Lucie'),
  'LI' => $t('Liechtenstein'),
  'LK' => $t('Sri Lanka'),
  'LR' => $t('Libéria'),
  'LS' => $t('Lesotho'),
  'LT' => $t('Lituanie'),
  'LU' => $t('Luxembourg'),
  'LV' => $t('Lettonie'),
  'LY' => $t('Libye'),
  'MA' => $t('Maroc'),
  'MC' => $t('Monaco'),
  'MD' => $t('Moldova'),
  'ME' => $t('Monténégro'),
  'MF' => $t('Saint Martin'),
  'MG' => $t('Madagascar'),
  'MH' => $t('Îles Marshall'),
  'MK' => $t('Macedoine'),
  'ML' => $t('Mali'),
  'MM' => $t('Myanmar'),
  'MN' => $t('Mongolie'),
  'MO' => $t('Macao S.A.R., Chine'),
  'MP' => $t('Îles Mariannes du Nord'),
  'MQ' => $t('Martinique'),
  'MR' => $t('Mauritanie'),
  'MS' => $t('Montserrat'),
  'MT' => $t('Malte'),
  'MU' => $t('Ile Maurice'),
  'MV' => $t('Maldives'),
  'MW' => $t('Malawi'),
  'MX' => $t('Mexique'),
  'MY' => $t('Malaysie'),
  'MZ' => $t('Mozambique'),
  'NA' => $t('Namibie'),
  'NC' => $t('Nouvelle Calédonie'),
  'NE' => $t('Niger'),
  'NF' => $t('Île Norfolk'),
  'NG' => $t('Nigeria'),
  'NI' => $t('Nicaragua'),
  'NL' => $t('Pays-Bas'),
  'NO' => $t('Norvège'),
  'NP' => $t('Népal'),
  'NR' => $t('Nauru'),
  'NU' => $t('Niue'),
  'NZ' => $t('Nouvelle-Zélande'),
  'OM' => $t('Oman'),
  'PA' => $t('Panama'),
  'PE' => $t('Pérou'),
  'PF' => $t('Polynésie française'),
  'PG' => $t('Papouasie Nouvelle Guinée'),
  'PH' => $t('Philippines'),
  'PK' => $t('Pakistan'),
  'PL' => $t('Pologne'),
  'PM' => $t('Saint Pierre et Miquelon'),
  'PN' => $t('Pitcairn'),
  'PR' => $t('Porto Rico'),
  'PS' => $t('Territoire Palestinien'),
  'PT' => $t('Portugal'),
  'PW' => $t('Palau'),
  'PY' => $t('Paraguay'),
  'QA' => $t('Qatar'),
  'RE' => $t('Réunion'),
  'RO' => $t('Roumanie'),
  'RS' => $t('Serbie'),
  'RU' => $t('Russie'),
  'RW' => $t('Rwanda'),
  'SA' => $t('Arabie Saoudite'),
  'SB' => $t('Les îles Salomon'),
  'SC' => $t('Seychelles'),
  'SD' => $t('Soudan'),
  'SE' => $t('Suède'),
  'SG' => $t('Singapour'),
  'SH' => $t('Sainte Hélène'),
  'SI' => $t('Slovénie'),
  'SJ' => $t('Svalbard et Jan Mayen'),
  'SK' => $t('Slovaquie'),
  'SL' => $t('Sierra Leone'),
  'SM' => $t('Saint Marin'),
  'SN' => $t('Sénégal'),
  'SO' => $t('Somalie'),
  'SR' => $t('Suriname'),
  'SS' => $t('Soudan du Sud'),
  'ST' => $t('Sao Tomé et Principe'),
  'SV' => $t('El Salvador'),
  'SX' => $t('Sint Maarten'),
  'SY' => $t('Syrie'),
  'SZ' => $t('Swaziland'),
  'TC' => $t('îles Turques-et-Caïques'),
  'TD' => $t('Tchad'),
  'TF' => $t('Terres Australes Françaises'),
  'TG' => $t('Togo'),
  'TH' => $t('Thaïlande'),
  'TJ' => $t('Tajikistan'),
  'TK' => $t('Tokelau'),
  'TL' => $t('Timor-Leste'),
  'TM' => $t('Turkménistan'),
  'TN' => $t('Tunisie'),
  'TO' => $t('Tonga'),
  'TR' => $t('Dinde'),
  'TT' => $t('Trinité-et-Tobago'),
  'TV' => $t('Tuvalu'),
  'TW' => $t('Taïwan'),
  'TZ' => $t('Tanzanie'),
  'UA' => $t('Ukraine'),
  'UG' => $t('Uganda'),
  'UM' => $t('Îles mineures éloignées des États-Unis'),
  'US' => $t('États-Unis'),
  'UY' => $t('Uruguay'),
  'UZ' => $t('Ouzbékistan'),
  'VA' => $t('Vatican'),
  'VC' => $t('Saint-Vincent-et-les-Grenades'),
  'VE' => $t('Venezuela'),
  'VG' => $t('Îles Vierges Britanniques'),
  'VI' => $t('Îles Vierges Américaines'),
  'VN' => $t('Viêt-Nam'),
  'VU' => $t('Vanuatu'),
  'WF' => $t('Wallis et Futuna'),
  'WS' => $t('Samoa'),
  'YE' => $t('Yémen'),
  'YT' => $t('Mayotte'),
  'ZA' => $t('Afrique du Sud'),
  'ZM' => $t('Zambie'),
  'ZW' => $t('Zimbabwe'),
  );
  return $countries;
}
